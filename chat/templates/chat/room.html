{% load static %}
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat Room</title>
  <link rel="stylesheet" href="{% static 'chat/style.css' %}">
</head>

<body>
  <div class="container">
    <div class="chat-layout">
      <!-- Sidebar (Hidden on mobile or simplified) -->
      <div class="sidebar">
        <div class="sidebar-header">
          <a href="{% url 'chat:index' %}">‚Üê Back</a>
        </div>
        <!-- We could duplicate the room list here if we passed it to the context,
                     but for now let's just have a back button -->
        <div style="padding: 20px; color: var(--text-muted); font-size: 0.9rem;">
          <p>Active Chat: <strong>{{ room_name }}</strong></p>
        </div>
      </div>

      <!-- Chat Area -->
      <div class="chat-area">
        <div class="chat-header">
          <h3>{{ room_name }}</h3> <!-- Ideally display name here -->
        </div>

        <div id="chat-log" class="chat-messages">
          {% for msg in messages %}
          <div class="message {% if msg.user == request.user %}sent{% else %}received{% endif %}"
            data-time="{{ msg.timestamp|date:'c' }}">
            <div class="message-sender">{{ msg.user.username }}</div>
            <div class="message-content">
              {% if msg.is_file %}
                <a href="{{ msg.content }}" target="_blank" style="color: inherit; text-decoration: underline;">File
                  Attachment</a>
                {% if msg.is_image %}
                  <br><img src="{{ msg.content }}" style="max-width: 200px; max-height: 200px; border-radius: 8px; margin-top: 5px;">
                {% endif %}
              {% else %}
                {{ msg.content }}
              {% endif %}
            </div>
            <!-- Time will be inserted by JS -->
          </div>
          {% empty %}
            <p>No messages yet.</p>
          {% endfor %}
        </div>

        <div class="chat-input-area">
          <div class="file-input-wrapper">
            <button class="btn-icon" onclick="document.getElementById('chat-file-input').click()">
              üìé
            </button>
            <input id="chat-file-input" type="file" style="display: none;" />
          </div>
          <span id="file-name-display" style="font-size: 0.8rem; color: var(--text-muted); margin-right: 10px; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></span>
          <input id="chat-message-input" class="chat-input" type="text" placeholder="Type a message..." />
          <button id="chat-message-submit" class="btn btn-primary">Send</button>
        </div>
      </div>
    </div>
  </div>

  {{ room_name|json_script:"room-name" }}
  <script>
    const my_id = {{ request.user.id }};
  </script>
  <script src="{% static 'chat/room.js' %}"></script>
</body>

</html>